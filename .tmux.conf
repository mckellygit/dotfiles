#
# byobu w/tmux 2.8+ tmux.conf config
#
unbind-key -n C-a
unbind-key -n C-s
set -g prefix ^S
set -g prefix2 None
bind s send-prefix

#if-shell '[[ $TERM =~ "-16color" ]]'  'set -g default-terminal screen-16color'
#if-shell '[[ $TERM =~ "-256color" ]]' 'set -g default-terminal tmux-256color'
set -g default-terminal "screen-256color"
set -g default-command "/usr/bin/zsh"
set -g status-bg colour8
set-window-option -g mode-keys vi
set -g base-index 1
setw -g pane-base-index 1

# dont wrap search around other end of scrollback buffer
set -g wrap-search off

bind-key -T prefix k confirm-before -p "kill-pane #P? (y/n)" kill-pane

# this was backslash, change to S
bind-key -T prefix S confirm-before kill-server
# need space after backslash here or put it in single quotes
unbind-key -T prefix '\'

set-window-option -g xterm-keys on

# approx scroll back limit
set -g history-limit 10000

set -g status-keys vi

# message display time (ms)
set -g display-time 371

# ==============================================

# --- old byobu settings that need to change for tmux v2.9+

# byobu env color settings:
# BYOBU_ACCENT=#75507B
# BYOBU_DARK=#333333
# BYOBU_HIGHLIGHT=#DD4814
# BYOBU_LIGHT=#EEEEEE

#set-option -g mode-fg $BYOBU_LIGHT
#set-option -g mode-bg $BYOBU_ACCENT
set -g mode-style "fg=$BYOBU_LIGHT,bg=$BYOBU_ACCENT"

#set-option -g pane-active-border-bg $BYOBU_HIGHLIGHT
#set-option -g pane-active-border-fg $BYOBU_HIGHLIGHT
set-option -g pane-active-border-style "fg=$BYOBU_HIGHLIGHT,bg=$BYOBU_HIGHLIGHT"

#set-option -g pane-border-fg $BYOBU_ACCENT
set-option -g pane-border-style "fg=$BYOBU_ACCENT,bg=default"

#set-window-option -g window-status-attr default
#set-window-option -g window-status-fg $BYOBU_LIGHT
#set-window-option -g window-status-bg $BYOBU_DARK
set -g window-status-style "fg=$BYOBU_LIGHT,bg=$BYOBU_DARK"

#set-window-option -g window-status-current-attr reverse
#set-window-option -g window-status-current-fg $BYOBU_LIGHT
#set-window-option -g window-status-current-bg $BYOBU_DARK
set -g window-status-current-style "reverse,fg=$BYOBU_LIGHT,bg=$BYOBU_DARK"

#set-window-option -g window-status-activity-attr bold
#set-window-option -g window-status-activity-fg $BYOBU_LIGHT
#set-window-option -g window-status-activity-bg $BYOBU_DARK
set -g window-status-activity-style "bold,fg=$BYOBU_LIGHT,bg=$BYOBU_DARK"

# does not appear to be used anymore
#set-window-option -g window-status-alert-attr bold
#set-window-option -g window-status-alert-fg $BYOBU_LIGHT
#set-window-option -g window-status-alert-bg $BYOBU_DARK
#set -g window-status-alert-style "bold,fg=$BYOBU_LIGHT,bg=$BYOBU_DARK"

#set -g message-fg white
#set -g message-bg $BYOBU_ACCENT
#set -g message-style "fg=white,bg=$BYOBU_ACCENT"

# --- old byobu settings that need to change for tmux v2.9+

# other byobu settings

# make sure to check/unbind F1-F12 in terminator/parent terminal program
# so S-F12 func key toggle does not also unmap C-Right, etc.
bind -n F1 new-window -k -n config byobu-config
# remove byobu rename to "-"
bind -n F2 new-window -c "#{pane_current_path}"
# prefix C-c and prefix c also start new window in curr dir
bind -n F3 previous-window
bind -n F4 next-window
bind -n F5 source-file /usr/share/byobu/profiles/tmuxrc
bind -n F6 detach-client
bind -n F7 copy-mode
bind -n F8 command-prompt -p "(rename-window) " "rename-window '%%'"
bind -n F9 new-window -k -n config byobu-config
# F11 often used in terminator for full-screen
bind-key -n S-F12 source $BYOBU_CONFIG_DIR/funckeys-disable.tmux \; display-message "Func-keys: DISABLED"

# ==============================================

# add C-s C-r to update IP etc ...
bind-key -T prefix C-r source-file /usr/share/byobu/profiles/tmuxrc \; refresh-client \; display-message "sourcing tmuxrc ..."

set -g mode-style "fg=black,bg=colour172"

set -g message-style "fg=black,bg=colour3"
set -g message-command-style "fg=black,bg=colour3"

# to make border thin set its bg to default
set-option -g pane-active-border-style "bg=default"

# current status background
set -g window-status-current-style "fg=$BYOBU_LIGHT,bg=#804000"

# -----------

# need to update all window bgs when a window goes away
# rotating window background
#set -g window-style 'fg=default,bg=#181b1b'
#set -g window-active-style 'fg=default,bg=#181b1b'
#bind -T prefix c new-window -c "#{pane_current_path}" \; run "tmux select-pane -P bg=$(echo #181b1b)"
# rotating status background
#set -g window-status-style "bg=#282828"
#bind -T prefix c new-window -c "#{pane_current_path}" \; run "tmux set window-status-style bg=$(idx=#I ; idx=$((idx+3)) ; idx=$((idx%3)) ; if [ \$idx -eq 1 ] ; then echo -n \"#282828\" ; elif [ \$idx -eq 2 ] ; then echo -n \"#484848\" ; else echo -n \"#686868\" ; fi)"

# to make active pane different bg than others
# set -g window-style 'fg=default,bg=colour236'
# set -g window-active-style 'fg=default,bg=colour235'
#
# look in colo[u]rscheme.vim or .vimrc and change:
# hi Normal ctermfg=none ctermbg=none
# to get the inactive style applied to Vim panes

# -----------

# to change status bar color in copy-mode
set-hook -g 'pane-mode-changed' 'set -gF status-left-style "fg=black,bg=#{?#{==:#{pane_mode},copy-mode},colour172,colour8}"'
set-hook -g 'session-window-changed' 'set -gF status-left-style "fg=black,bg=#{?#{==:#{pane_mode},copy-mode},colour172,colour8}"'

# -----------

# move window tabs around
bind-key -T prefix < swap-window -t -1
bind-key -T prefix > swap-window -t +1

# -----------

# vert split  - meaning a vert  cut ... (opposite of tmux but same as vi)
bind-key -T prefix H split-window -v -c "#{pane_current_path}"
# horiz split - meaning a horiz cut ... (opposite of tmux but same as vi)
bind-key -T prefix V split-window -h -c "#{pane_current_path}"
# use shift+arrow to navigate to next window

# synchronize panes
bind-key -T prefix G set -w synchronize-panes \; display-message "synchronize-panes: #{?pane_synchronized,ON,OFF}"

# M-S- Up, Down, Left, Right to resize panes (Alt-Shift)

# C-s z to toggle pane zoom

# -----------

# for repeat Left/Right
set -g repeat-time 1000

# this is a -s option now ...
set -s escape-time 10

# move around panes

# next ------

# existing mappings:
#bind-key -T prefix C-Space next-window
#bind-key -T prefix Space   next-window
#bind-key -T prefix C-n     next-window
#bind-key -T prefix n       next-window
#bind-key -T prefix M-n     next-window -a

# C-Right used in vim for next word
# make sure to unbind Alt-Right in terminator/parent terminal program
unbind-key -T root M-Right
# M-Right used in vim for next tab
unbind-key -T root C-S-Right
# C-S-Right used in vim for next tab
bind-key -r -T prefix Right next
bind-key -r -T prefix C-Right next
# Super-Right (used by unity/terminator ?)
# S-Right used by tmux to traverse panes
# C-M-Right does not seem to work in tmux

# overloading C-Right is too confusing
#bind -T root C-Right \
#	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
#		"if-shell -Ft= '#{alternate_on}' \
#			'send-keys C-Right' \
#			'next'"

# if we map C-^ to C-\ in vim we can use C-\ here
#bind -T root C-\ next
# But also C-\ is often stty quit ...
# if not #{alternate_on} dont send C-\ key
# data to prevent extraneous chars in output
bind-key -T root C-\ \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'send-keys C-\\' \
            ''"

# need space after backslash
#bind -T prefix \  next

#bind -T root M-\ next

# C-BSpace in terminator is mapped to M-BSpace (Esc-BSpace)
bind -T root M-BSpace next

# C-S-Space in terminator is mapped to M-4
bind -T root M-4 next

# ccsm uses M-Space as Window menu
#bind -T root M-Space next

# zig-zag traversal
#bind -T root C-Space run "tmux select-window -t $(if [ ! -f /dev/shm/tmux_dir ] ; then echo 2 > /dev/shm/tmux_dir ; fi ; wcnt=$(tmux list-windows | wc -l) ; dir=$(cat /dev/shm/tmux_dir) ; d0=$((\$dir&1)) ; d1=$((\$dir&6)) ; if [ \$d0 -eq 1 ] ; then if [ \$d1 -eq 2 ] ; then d1=4 ; else d1=2 ; fi; fi ; if [ \$d1 -eq 2 ] ; then if [ #I -gt 1 ] ; then echo $((#I-1)) ; else echo 4 > /dev/shm/tmux_dir ; if [ #I -lt \$wcnt ] ; then echo $((#I+1)) ; else echo 1 ; fi ; fi ; else if [ #I -lt \$wcnt ] ; then echo $((#I+1)) ; else echo 2 > /dev/shm/tmux_dir ; if [ #I -gt 1 ] ; then echo $((#I-1)) ; else echo 1 ; fi ; fi ; fi)"

# prev ------

# existing mappings:
#bind-key -T prefix C-h     previous-window
#bind-key -T prefix BSpace  previous-window
#bind-key -T prefix C-p     previous-window
#bind-key -T prefix p       previous-window
#bind-key -T prefix M-p     previous-window -a

# C-Left used in vim for prev word
# make sure to unbind Alt-Left in terminator/parent terminal program
unbind-key -T root M-Left
# M-Left used in vim for prev tab
unbind-key -T root C-S-Left
# C-S-Left used in vim for prev tab
bind-key -r -T prefix Left prev
bind-key -r -T prefix C-Left prev
# Super-Left (used by unity/terminator ?)
# S-Left used by tmux to traverse panes
# C-M-Left does not seem to work in tmux

# overloading C-Left is too confusing
#bind -T root C-Left \
#	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
#		"if-shell -Ft= '#{alternate_on}' \
#			'send-keys C-Left' \
#			'prev'"

# could also be shell backward-kill-word
#bind -T root C-p prev
# if not #{alternate_on} dont send C-p key
# data to prevent extraneous chars in output
bind-key -T root C-p \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'send-keys C-p' \
            ''"

# C-S-\ in terminator is mapped to M-3 [no more]
# C-= in terminator is mapped to M-3
bind -T root M-3 prev

# C-S-BSpace in terminator is mapped to M-2
bind -T root M-2 prev

bind -T root C-Space prev

# zig-zag traversal
#bind -T root C-p run "tmux select-window -t $(if [ ! -f /dev/shm/tmux_dir ] ; then echo 5 > /dev/shm/tmux_dir ; fi ; wcnt=$(tmux list-windows | wc -l) ; dir=$(cat /dev/shm/tmux_dir) ; d0=$((\$dir&1)) ; d1=$((\$dir&6)) ; if [ \$d0 -eq 0 ] ; then if [ \$d1 -eq 2 ] ; then d1=4 ; else d1=2 ; fi ; fi ; if [ \$d1 -eq 2 ] ; then if [ #I -gt 1 ] ; then echo $((#I-1)) ; else echo 5 > /dev/shm/tmux_dir ; if [ #I -lt \$wcnt ] ; then echo $((#I+1)) ; else echo 1 ; fi ; fi ; else if [ #I -lt \$wcnt ] ; then echo $((#I+1)) ; else echo 3 > /dev/shm/tmux_dir ; if [ #I -gt 1 ] ; then echo $((#I-1)) ; else echo 1 ; fi ; fi ; fi)"

# -----------

# NOTE: C-M-p used by parcellite
# NOTE: C-S-p used by terminator

# NOTE: M-Up used by terminator
unbind-key -T root M-Up
# NOTE: M-Down used by terminator
unbind-key -T root M-Down

# M-S-Up/Down/Left/Right to resize panes ...

# -----------

# copy-mode

# xclip -i -l 1 -sel c -nofork -rmlastnl -sc
# xsel -i -p --rmlastnl --sc

# Enter copy-mode with 'prefix-[' (also prefix-Esc)
# when entering copy-mode, clear primary clipboard
# so mouse paste from window mgr does send any data
#bind-key [ run "xclip -sel p </dev/null >/dev/null ; tmux copy-mode"
bind-key -T prefix [ \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'copy-mode' \
            'copy-mode \; send -XN 2 cursor-left'"
# also add C-[ as that is easily pressed
#bind-key C-[ run "xclip -sel p </dev/null >/dev/null ; tmux copy-mode"
# dont add C-[ as that is also Esc
#bind-key C-[ copy-mode
# ']' was originally set to paste-buffer
# but its nice to also go into copy-mode
#bind-key ] run "xclip -sel p </dev/null >/dev/null ; tmux copy-mode"
bind-key -T prefix ] \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'copy-mode' \
            'copy-mode \; send -XN 2 cursor-left'"
# also add C-] as that is easily pressed
#bind-key C-] run "xclip -sel p </dev/null >/dev/null ; tmux copy-mode"
bind-key -T prefix C-] \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'copy-mode' \
            'copy-mode \; send -XN 2 cursor-left'"

# if not #{alternate_on} dont send C-] key
# data to prevent extraneous chars in output
bind-key -T root C-] \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'send-keys C-]' \
            ''"

# if not #{alternate_on} dont send C-o key
# data to prevent extraneous chars in output
bind-key -T root C-o \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'send-keys C-o' \
            ''"

# if not #{alternate_on} dont send C-n key
# data to prevent extraneous chars in output
bind-key -T root C-n \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'send-keys C-n' \
            ''"

# if not #{alternate_on} dont send C-_ (really C-/) key
# data to prevent extraneous chars in output
bind-key -T root C-_ \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'send-keys C-_' \
            ''"

# vim may remap C-y to paste before cursor ...
# default mapping in copy-mode-vi is scroll-up
unbind-key -T copy-mode-vi C-y
# if not #{alternate_on} dont send C-y key
# data to prevent extraneous chars in output
bind-key -T root C-y \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'send-keys C-y' \
            ''"
# or should C-y paste from root and/or copy-mode ?

# =================================================

# NOTE: rule for embedded quotes is 2x+1 so: 1, 3, 7, 15, 31 ...

# NOTE: could add "xsel -o -p 2>/dev/null | xsel -i -p -t 5000"
# to get selection into PRIMARY, but parcellite can do that also

# global add space toggle (look into set-environment, update-environment)
# NOTE: coordinate any changes here with $BYOBU_CONFIG_DIR/bin/5_addspc
bind -n C-F12 run "if [ ! -f /dev/shm/tmux#{session_name}.spc ] ; then add=1 ; else add=$(cat /dev/shm/tmux#{session_name}.spc) ; fi ; if [ \$add -eq 1 ] ; then echo 0 > /dev/shm/tmux#{session_name}.spc ; echo \"#[default]#[fg=colour13,bold,bg=\\$BYOBU_DARK]-#[default]#[fg=\\$BYOBU_LIGHT]#[bg=\\$BYOBU_DARK] \" > $BYOBU_RUN_DIR/cache.tmux/custom.5_addspc ; tmux display-message \"Add Space: OFF\" ; else echo 1 > /dev/shm/tmux#{session_name}.spc ; echo \"#[default]#[fg=colour13,bold,bg=\\$BYOBU_DARK]+#[default]#[fg=\\$BYOBU_LIGHT]#[bg=\\$BYOBU_DARK] \" > $BYOBU_RUN_DIR/cache.tmux/custom.5_addspc ; tmux display-message \"Add Space: ON\" ; fi ; tr -d '\n' < $BYOBU_RUN_DIR/cache.tmux/custom.5_addspc > $BYOBU_RUN_DIR/status.tmux/custom" \; refresh-client -S \; refresh-client -S

# TODO: figure out clipboard and buffer create date and use newest

# do we want to add space (based on config) to clipboard if we cancel copy-mode ?
# (y)ank does not add space, (Y)ank does add space
# dragging mouse for selection does not, Esc to cancel does not
# DoubleClick and Ctrl-Click and Alt-Click add space to clipboard
# \ws, C-s-v, C-Insert, M-Insert add space

# =================================================

# NOTE: if bracketed-paste in shell is not enabled then could use paste-buffer -s ' ' instead of -p ...
# TODO: could have a toggle for this

# C-s v
# in copy-mode, if selection then cancel and paste; else cancel, paste from clipboard
# in root mode, if alternate do nothing (TODO: or perhaps send C-s v); else paste from clipboard
bind-key -T prefix v \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= \"#{alternate_on}\" \
            'send-keys -l =' \
            'if-shell -Ft= \"#{pane_in_mode}\" \
                \"if-shell -Ft= \\\"#{selection_present}\\\" \
                    \\\"send -X copy-pipe-and-cancel \\\\\\\"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\\\\\\\" ; run \\\\\\\"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\\\\\\\"\\\" \
                    \\\"send -X cancel ; run \\\\\\\"xsel -o -p > /dev/shm/tmux$$.buf ; if [ -f /dev/shm/tmux$$.buf ] ; then tmux load-buffer /dev/shm/tmux$$.buf ; rm -f /dev/shm/tmux$$.buf ; tmux paste-buffer -dp ; fi\\\\\\\" \\\" \" \
                \"run \\\"xsel -o -p > /dev/shm/tmux$$.buf ; if [ -f /dev/shm/tmux$$.buf ] ; then tmux load-buffer /dev/shm/tmux$$.buf ; rm -f /dev/shm/tmux$$.buf ; tmux paste-buffer -dp ; fi\\\" \" ' "

# C-s C-v (same as C-s v above)
bind-key -T prefix C-v \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= \"#{alternate_on}\" \
            'send-keys -l =' \
            'if-shell -Ft= \"#{pane_in_mode}\" \
                \"if-shell -Ft= \\\"#{selection_present}\\\" \
                    \\\"send -X copy-pipe-and-cancel \\\\\\\"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\\\\\\\" ; run \\\\\\\"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\\\\\\\"\\\" \
                    \\\"send -X cancel ; run \\\\\\\"xsel -o -p > /dev/shm/tmux$$.buf ; if [ -f /dev/shm/tmux$$.buf ] ; then tmux load-buffer /dev/shm/tmux$$.buf ; rm -f /dev/shm/tmux$$.buf ; tmux paste-buffer -dp ; fi\\\\\\\" \\\" \" \
                \"run \\\"xsel -o -p > /dev/shm/tmux$$.buf ; if [ -f /dev/shm/tmux$$.buf ] ; then tmux load-buffer /dev/shm/tmux$$.buf ; rm -f /dev/shm/tmux$$.buf ; tmux paste-buffer -dp ; fi\\\" \" ' "

# =================================================

# Delete is DC

# add M-Insert (IC) because C-S-v (from OS) does not work within copy-mode
unbind-key -T root M-IC
bind-key   -T root M-IC \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'send-keys M-IC' \
            'run \"xsel -o -p > /dev/shm/tmux$$.buf ; if [ -f /dev/shm/tmux$$.buf ] ; then tmux load-buffer /dev/shm/tmux$$.buf ; rm -f /dev/shm/tmux$$.buf ; tmux paste-buffer -dp ; fi\"'"
unbind-key -T copy-mode-vi M-IC
bind-key   -T copy-mode-vi M-IC \
    if-shell -Ft= "#{selection_present}" \
        "send -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\" ; run \"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\" " \
        "send -X cancel ; run \"xsel -o -p > /dev/shm/tmux$$.buf ; if [ -f /dev/shm/tmux$$.buf ] ; then tmux load-buffer /dev/shm/tmux$$.buf ; rm -f /dev/shm/tmux$$.buf ; tmux paste-buffer -dp ; fi\""

# C-Insert (IC) in terminator is mapped to M-1
unbind-key -T root M-1
bind-key   -T root M-1 \
    if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
        "if-shell -Ft= '#{alternate_on}' \
            'send-keys M-1' \
            'run \"xsel -o -p > /dev/shm/tmux$$.buf ; if [ -f /dev/shm/tmux$$.buf ] ; then tmux load-buffer /dev/shm/tmux$$.buf ; rm -f /dev/shm/tmux$$.buf ; tmux paste-buffer -dp ; fi\"'"
unbind-key -T copy-mode-vi M-1
bind-key   -T copy-mode-vi M-1 \
    if-shell -Ft= "#{selection_present}" \
        "send -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\" ; run \"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\" " \
        "send -X cancel ; run \"xsel -o -p > /dev/shm/tmux$$.buf ; if [ -f /dev/shm/tmux$$.buf ] ; then tmux load-buffer /dev/shm/tmux$$.buf ; rm -f /dev/shm/tmux$$.buf ; tmux paste-buffer -dp ; fi\""

# =================================================

bind-key -T copy-mode-vi Home send-keys -X start-of-line
bind-key -T copy-mode-vi End  send-keys -X end-of-line

# terminator <C-Home> mapped to <Esc>5
bind-key -T copy-mode-vi M-5  send-keys -X history-top
# terminator <C-End> mapped to <Esc>6
bind-key -T copy-mode-vi M-6  send-keys -X history-bottom \; send -l 0$

# if cursor-down-and-copy command exists ... but leave j alone
bind-key -T copy-mode-vi Down   if -F "#{selection_present}" "send -X cursor-down" "send -X cursor-down-and-cancel"

# vim-like mappings for copy-mode cut/paste ...
bind-key -T copy-mode-vi C-j    if -F "#{selection_present}" "send -X scroll-down" "send -X scroll-down-and-cancel"
bind-key -T copy-mode-vi C-Down if -F "#{selection_present}" "send -X scroll-down" "send -X scroll-down-and-cancel"
bind-key -T copy-mode-vi C-k    send-keys -X scroll-up
bind-key -T copy-mode-vi C-Up   send-keys -X scroll-up

bind-key -T copy-mode-vi C-a send-keys -X start-of-line
bind-key -T copy-mode-vi C-e send-keys -X end-of-line

# only real difference is C-v starts a new selection here but toggles in vim
# V for line selection
# C-v for rect selection from current col
#bind-key -T copy-mode-vi C-v send-keys -X begin-selection \; send-keys -X rectangle-toggle
# seems a little better ...
bind-key -T copy-mode-vi v   if -F "#{selection_present}" "" "send-keys -X begin-selection"
bind-key -T copy-mode-vi V   if -F "#{selection_present}" "" "send-keys -X select-line"
bind-key -T copy-mode-vi C-v if -F "#{selection_present}" "send-keys -X rectangle-toggle" "send-keys -X begin-selection ; send-keys -X rectangle-toggle"

# enter copy-mode and start selection
#bind-key -T prefix v copy-mode \; send-keys -X begin-selection
# conflicts with vertical split
#bind-key -T prefix V copy-mode \; send-keys -X select-line

# <Leader>ws - match vim word-select
bind-key -T copy-mode-vi '\' switch-client -T LEADER
bind-key -T LEADER w switch-client -T LEADER
bind-key -T LEADER s send-keys -l lbve \; send -X copy-pipe-no-clear "xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc"
# <Leader>wS - match vim WORD (lBvE)
bind-key -T LEADER S send-keys -l lBvE \; send -X copy-pipe-no-clear "xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc"
# <Leader>wp - match C-MouseUp1Pane to select whole file path
bind-key -T LEADER p set word-separators " ='`;:+|[](){},?\\\"" \; send -l lbve \; set word-separators " ='`;:+|[](){},/?\\\"" \; send -X copy-pipe-no-clear "xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc"

# TODO: new search mappings available:
#bind -Tcopy-mode-vi '#' 'send -FX search-backward "#{copy_cursor_word}"'
#bind -Tcopy-mode-vi '*' 'send -FX search-forward  "#{copy_cursor_word}"'

# <Leader>wf - match vim search for word under cursor
bind-key -T LEADER f         if -F "#{selection_present}" "send -X stop-selection \; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl\" \; send -X clear-selection \; run \"sw=\$(xsel -o -p) ; tmux copy-mode ; tmux send -X search-forward \\\${sw}\"" "send-keys -l lbve \; send -X stop-selection \; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl\" \; send -X clear-selection \; run \"sw=\$(xsel -o -p) ; tmux copy-mode ; tmux send -X search-forward \\\${sw}\""
# and *
bind-key -T copy-mode-vi '*' if -F "#{selection_present}" "send -X stop-selection \; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl\" \; send -X clear-selection \; run \"sw=\$(xsel -o -p) ; tmux copy-mode ; tmux send -X search-forward \\\${sw}\"" "send-keys -l lbve \; send -X stop-selection \; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl\" \; send -X clear-selection \; run \"sw=\$(xsel -o -p) ; tmux copy-mode ; tmux send -X search-forward \\\${sw}\""
# <Leader>wF - match vim search backward for word under cursor
bind-key -T LEADER F         if -F "#{selection_present}" "send -X stop-selection \; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl\" \; send -X clear-selection \; run \"sw=\$(xsel -o -p) ; tmux copy-mode ; tmux send -X search-backward \\\${sw}\"" "send-keys -l lbve \; send -X stop-selection \; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl\" \; send -X clear-selection \; run \"sw=\$(xsel -o -p) ; tmux copy-mode ; tmux send -X search-backward \\\${sw}\""
# and '#' - put in single quotes
bind-key -T copy-mode-vi '#' if -F "#{selection_present}" "send -X stop-selection \; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl\" \; send -X clear-selection \; run \"sw=\$(xsel -o -p) ; tmux copy-mode ; tmux send -X search-backward \\\${sw}\"" "send-keys -l lbve \; send -X stop-selection \; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl\" \; send -X clear-selection \; run \"sw=\$(xsel -o -p) ; tmux copy-mode ; tmux send -X search-backward \\\${sw}\""

# match vim word nav
bind-key -T copy-mode-vi C-Right send-keys -l w
bind-key -T copy-mode-vi C-Left  send-keys -l b

# disable prefix-d to detach (only use prefix C-d)
unbind-key -T prefix d

# should Return/Enter copy and cancel ?
#orig: bind-key   -T copy-mode-vi Enter send-keys -X copy-selection-and-cancel
# same as y(ank) or C-c
bind-key -T copy-mode-vi Enter send-keys C-c
#unbind-key -T copy-mode-vi Enter

# disable previous Space to begin-selection
unbind-key -T copy-mode-vi Space
# map Space to clear selection ???
#bind-key   -T copy-mode-vi Space send-keys -X clear-selection

# map Esc to quit copy-mode (as in vi)
bind-key   -T copy-mode-vi Escape send-keys -X cancel

# disable previous q to quit copy-mode
unbind-key -T copy-mode-vi q
# map q to clear selection ???
bind-key   -T copy-mode-vi q send-keys -X clear-selection

bind-key   -T copy-mode-vi x send-keys -X stop-selection

# an alternative to Esc to cancel copy-mode
bind-key   -T copy-mode-vi C-q send-keys -X cancel

# more meaningful cmd-prompt
bind -T prefix : command-prompt -p "tmux:"

# yank to clipboard ...
#
# no longer use tmux-yank plugin
# https://github.com/tmux-plugins/tmux-yank.git
#set -g @copy_mode_yank "C-c"
#set -g @shell_mode "vi"
#run-shell ~/.byobu/tmux-yank/yank.tmux

# NOTE: re: selection and appending trailing space ...
# C-c, y (yank) and mouse drag do NOT add trailing space - we assume you are yanking exactly what you want
# Most other selection methods (double-click, \ws, status-left-click, etc.) assume some sort of
# cmd-line paste and add a trailing space if configured to do so (C-F12)

# simple method to copy to clipboard that seems to work in v2.4+
# also clear primary clipboard so mouse paste from window mgr does send any data
# if no selection then cancel copy-mode
bind-key -T copy-mode-vi C-c if -F "#{selection_present}" "send-keys -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl\" \; display-message \"copied to primary and clipboard\"" "send -X cancel"
#bind-key -T copy-mode-vi C-c send-keys -X copy-pipe-no-clear "xclip -sel p </dev/null >/dev/null ; xclip -sel c >/dev/null" \; display-message "copied to clipboard"
# copy to only clipboard
#bind-key -T copy-mode-vi C-c send-keys -X copy-pipe-no-clear "xclip -sel c >/dev/null" \; display-message "copied to clipboard"
# copy to both
#bind-key -T copy-mode-vi C-c send-keys -X copy-pipe-no-clear "xclip -sel c >/dev/null ; xclip -o -sel c | xclip -sel p >/dev/null" \; display-message "copied to clipboard"

# also map 'y' to match vim yank
# if no selection then no-op
bind-key -T copy-mode-vi y if -F "#{selection_present}" "send-keys -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl\" \; display-message \"copied to primary and clipboard\"" ""
# NOTE: instead of clearing primary, could also copy to primary
#       (or use external program like parcellite/ClipIt to keep primary/clipboard in sync)
#       (and then dont need extra "xsel -o -p | xclip -sel p" cmds to keep in sync ...)

# Y to add trailing space if enabled
bind-key -T copy-mode-vi Y if -F "#{selection_present}" \
    "send-keys -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\" \; display-message \"copied to primary and clipboard\"" ""

# explicit copy to primary (and clipboard)
#bind-key -T copy-mode-vi C-r send-keys -X copy-pipe-and-cancel "xclip -sel c >/dev/null ; xclip -o -sel c | xclip -sel p >/dev/null" \; display-message "copied to primary and clipboard"
#bind-key -T copy-mode-vi C-r send-keys -X copy-pipe-no-clear "xclip -sel c >/dev/null ; xclip -o -sel c | xclip -sel p >/dev/null" \; display-message "copied to primary and clipboard"

# NOTE: does not work if parcellite or ClipIt is syncing clipboards ...
# explicit clear clipboards (but not tmux buffers!)
#bind-key -T copy-mode-vi C-o run "xclip -l 1 -q -sel p </dev/null 2>/dev/null ; xclip -l 1 -q -sel c </dev/null 2>/dev/null" \; send -X clear-selection \; display-message "primary and clipboard cleared"

# ----------------------------------------------
# Wish we could use right mouse button (paste) to also
# cancel copy-mode but it is often highjacked by window manager
# (test of pasting buffer of 'q<abc...>' shows issue)
# shift + left-mouse-button to select/copy to primary
# shift + right-mouse-button to paste from primary
# But perhaps we can use C-Mouse1Up to do this (see below)
#
# IDEA: tmux mods to cmd-paste-buffer.c
#       to cancel copy-mode on paste
#
#static enum cmd_retval
#cmd_paste_buffer_exec(struct cmd *self, struct cmdq_item *item)
# {
#   ...
#   if (pb != NULL && args_has(args, 'd'))
#       paste_free(pb);
#
#   // mck - cancel copy-mode on paste ...
#   if (wp != NULL && wp->mode == &window_copy_mode)
#       window_pane_reset_mode(wp);
#   // mck
#
#   return (CMD_RETURN_NORMAL);
# }
#
# get by with C-Mouse1Up to paste and cancel copy-mode
#bind -n C-MouseUp1Pane \
#    if-shell -Ft= "#{pane_in_mode}" \
#        "send -X cancel ; paste-buffer -dp ; send Space" \
#        "if-shell -Ft= '#{alternate_on}' \
#            '' \
#            'paste-buffer -dp ; send Space'"
# could we also copy selection to the primary clipboard ?

bind -T copy-mode-vi C-MouseUp1Pane \
    select-pane \; send -X clear-selection \; set word-separators " ='`;:+|[](){},?\\\"" \; send -l lbve \; send -X stop-selection \; set word-separators " ='`;:+|[](){},/?\\\"" \; send -X copy-pipe-no-clear "xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc"
# same as above, but cancel copy mode - could also paste to cmdline then optionally send Space
bind -T copy-mode-vi M-MouseUp1Pane \
    select-pane \; send -X clear-selection \; set word-separators " ='`;:+|[](){},?\\\"" \; send -l lbve \; send -X stop-selection \; set word-separators " ='`;:+|[](){},/?\\\"" \; send -X copy-pipe-no-clear "xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc" \; run "sleep 0.30" \; send -X cancel \; run "xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp"

bind -T root C-MouseUp1Pane \
    if-shell -Ft= "#{alternate_on}" \
        "send-keys C-MouseUp1Pane" \
        "select-pane ; copy-mode ; send -X clear-selection ; set word-separators \" ='`;:+|[](){},?\\\\\\\"\" ; send -l lbve ; send -X stop-selection ; set word-separators \" ='`;:+|[](){},/?\\\\\\\"\" ; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\""
# same as above, but cancel copy mode - could also paste to cmdline then optionally send Space
bind -T root M-MouseUp1Pane \
    if-shell -Ft= "#{alternate_on}" \
        "send-keys M-MouseUp1Pane" \
        "select-pane ; copy-mode ; send -X clear-selection ; set word-separators \" ='`;:+|[](){},?\\\\\\\"\" ; send -l lbve ; send -X stop-selection ; set word-separators \" ='`;:+|[](){},/?\\\\\\\"\" ; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\" ; run \"sleep 0.30\" ; send -X cancel ; run \"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\""

# IDEA about appending selection to a cmdline buffer ...
#      if appending to cmdline buffer, perhaps use StatusLeft clicks to clear buffer ?

# for now, if cmdline not empty send Enter to execute cmdline ...
bind -T root TripleClick1StatusLeft \
    if-shell -Ft= "#{alternate_on}" \
        "" \
        "run \"nf=$(tmux capture-pane -p | tac | sed '/^$/d' | head -n 1 | awk '{print NF-1}') ; if [ \\\$nf -gt 0 ] ; then tmux send-keys Enter ; fi\""
# Alt-StatusLeft - same as above
bind -T root M-TripleClick1StatusLeft \
    if-shell -Ft= "#{alternate_on}" \
        "" \
        "run \"nf=$(tmux capture-pane -p | tac | sed '/^$/d' | head -n 1 | awk '{print NF-1}') ; if [ \\\$nf -gt 0 ] ; then tmux send-keys Enter ; fi\""
# Ctrl-StatusLeft - clear cmdline
bind -T root C-TripleClick1StatusLeft \
    if-shell -Ft= "#{alternate_on}" \
        "" \
        "run \"nf=$(tmux capture-pane -p | tac | sed '/^$/d' | head -n 1 | awk '{print NF-1}') ; if [ \\\$nf -gt 0 ] ; then tmux send-keys -l ; fi\""

# same as Triple Left
bind -T root TripleClick1StatusRight \
    if-shell -Ft= "#{alternate_on}" \
        "" \
        "run \"nf=$(tmux capture-pane -p | tac | sed '/^$/d' | head -n 1 | awk '{print NF-1}') ; if [ \\\$nf -gt 0 ] ; then tmux send-keys Enter ; fi\""
# Alt-StatusRight - same as above
bind -T root M-TripleClick1StatusRight \
    if-shell -Ft= "#{alternate_on}" \
        "" \
        "run \"nf=$(tmux capture-pane -p | tac | sed '/^$/d' | head -n 1 | awk '{print NF-1}') ; if [ \\\$nf -gt 0 ] ; then tmux send-keys Enter ; fi\""
# Ctrl-StatusRight - same as above
bind -T root C-TripleClick1StatusRight \
    if-shell -Ft= "#{alternate_on}" \
        "" \
        "run \"nf=$(tmux capture-pane -p | tac | sed '/^$/d' | head -n 1 | awk '{print NF-1}') ; if [ \\\$nf -gt 0 ] ; then tmux send-keys Enter ; fi\""

#       could do this instead to remove trailing linefeed -
#       "send -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\" ; run \"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\" " \
#       or paste-buffer -s '' -dp (ok in single line), but best is really just to use bracketed-paste in all shells

# and cancel copy-mode, paste selection, but dont Enter ...
bind-key -T copy-mode-vi MouseUp1StatusLeft \
    if-shell -Ft= "#{selection_present}" \
        "send -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\" ; run \"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\" " \
        "send -X cancel"
# same as above
bind-key -T copy-mode-vi C-MouseUp1StatusLeft \
    if-shell -Ft= "#{selection_present}" \
        "send -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\" ; run \"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\" " \
        "send -X cancel"
# same as C-MouseUp1StatusLeft
bind-key -T copy-mode-vi M-MouseUp1StatusLeft \
    if-shell -Ft= "#{selection_present}" \
        "send -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\" ; run \"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\" " \
        "send -X cancel"

# and cancel copy-mode, paste selection, but dont Enter ...
bind-key -T copy-mode-vi MouseUp1StatusRight \
    if-shell -Ft= "#{selection_present}" \
        "send -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\" ; run \"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\" " \
        "send -X cancel"
# same as above
bind-key -T copy-mode-vi C-MouseUp1StatusRight \
    if-shell -Ft= "#{selection_present}" \
        "send -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\" ; run \"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\" " \
        "send -X cancel"
# same as C-MouseUp1StatusRight
bind-key -T copy-mode-vi M-MouseUp1StatusRight \
    if-shell -Ft= "#{selection_present}" \
        "send -X copy-pipe-and-cancel \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\" ; run \"xsel -o -p | tmux load-buffer - ; tmux paste-buffer -dp\" " \
        "send -X cancel"

# when have Double/Triple click mapped, can be confusing to also have single click mapped ...
#bind-key -T root         MouseUp1StatusRight next
#bind-key -T copy-mode-vi MouseUp1StatusRight next

# seems to mess things up
unbind-key -T prefix C-z

# C-s C-a
# in copy-mode, do nothing
# in root mode, if alternate do nothing (TODO: or perhaps send C-s C-a); else up arrow for previous cmd
bind-key -T prefix C-a \
    if-shell -Ft= "#{pane_in_mode}" \
        "" \
        "if-shell -Ft= \"#{alternate_on}\" \
            \"\" \
            \"send-keys Up\" "

# C-s C-x
# in copy-mode, do nothing
# in root mode, if alternate do nothing (TODO: or perhaps send C-s C-x); else if cmdline not empty then Enter
bind-key -T prefix C-x \
    if-shell -Ft= "#{pane_in_mode}" \
        "" \
        "if-shell -Ft= \"#{alternate_on}\" \
            \"\" \
            \"run \\\"nf=$(tmux capture-pane -p | tac | sed '/^$/d' | head -n 1 | awk '{print NF-1}') ; if [ \\\\\\\$nf -gt 0 ] ; then tmux send-keys Enter ; fi\\\" \" "

# Alt-Mouse3 may be mapped to window resize in gnome
# To change it to <Super>:
# gsettings set org.gnome.desktop.wm.preferences resize-with-right-button true
# gsettings set org.gnome.desktop.wm.preferences mouse-button-modifier '<Super>'
#bind -n M-MouseUp3Pane \
#	if-shell -Ft= "#{pane_in_mode}" \
#		"send -X cancel; paste-buffer -dp; send Space" \
#		"paste-buffer -dp; send Space"
# ----------------------------------------------

# Look into for terminals that support these
# Esc sequences for sending over ssh etc. ...
# could be on | external | off
set -g set-clipboard off

# update interval
set -g status-interval 10

# if focus events supported
set -g focus-events on

# default is " -_@"
# (different than vim due to vim c/c++ devel)
set -g word-separators " ='`;:+|[](){},/?\\\""

# Set window title string
#  #H  Hostname of local host
#  #I  Current window index
#  #P  Current pane index
#  #S  Session name
#  #T  Current window title
#  #W  Current window name
#  #   A literal ‘#’
set-window-option -g automatic-rename on
# sets window name to basename of dir
# set-option -g automatic-rename-format '#{b:pane_current_path}'
set-option -g automatic-rename-format '#{pane_title}'
set-option -g allow-rename on
set-option -g set-titles off
set-option -g set-titles-string "#I:#W"
# auto renumber windows on close
setw -g renumber-windows on

# Make sure to also unmap terminal (ie terminator)
# Ctrl-PgUp/Dn keys for these to take effect

# many [x]terminals use/map Shift-PgUp/Dn ...
#bind-key -T copy-mode-vi S-PPage halfpage-up
#bind-key -T copy-mode-vi S-NPage halfpage-down

unbind -T prefix PPage
unbind -T prefix NPage

bind   -T copy-mode-vi PPage   send-keys -X page-up
# same for ctrl-b, but half-page scroll
bind   -T copy-mode-vi C-b     send-keys -X halfpage-up

bind   -T copy-mode-vi NPage   if -F "#{selection_present}" "send -X page-down" "send -X page-down-and-cancel"
# same for ctrl-f, but half-page scroll
bind   -T copy-mode-vi C-f     if -F "#{selection_present}" "send -X halfpage-down" "send -X halfpage-down-and-cancel"

bind   -T copy-mode-vi C-PPage send-keys -X halfpage-up
bind   -T copy-mode-vi C-NPage if -F "#{selection_present}" "send -X halfpage-down" "send -X halfpage-down-and-cancel"

bind   -T copy-mode-vi M-PPage send-keys -XN 4 page-up
bind   -T copy-mode-vi M-NPage if -F "#{selection_present}" "send -XN 4 page-down" "send -XN 4 page-down-and-cancel"

# first press scroll half and enter copy-mode
bind -T root PPage \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= '#{alternate_on}' \
			'send-keys PPage' \
			'copy-mode ; send -XN 2 cursor-left ; send -X halfpage-up'"

# same for ctrl-b, but half-page scroll
# but make initial less than that ... 10 seems ok
bind -T root C-b \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= '#{alternate_on}' \
			'send-keys C-b' \
			'copy-mode ; send -XN 2 cursor-left ; send -XN 10 scroll-up'"

# first press scroll half and enter copy-mode
# instead of PPage, guess that 20 lines is about half a page
bind -T root C-PPage \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= '#{alternate_on}' \
			'send-keys -N 20 Up' \
			'copy-mode ; send -XN 2 cursor-left ; send -X halfpage-up'"

bind -T root M-PPage \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= '#{alternate_on}' \
			'send-keys -N 4 PPage' \
			'copy-mode ; send -XN 2 cursor-left ; send -XN 2 page-up'"

# if not #{alternate_on} dont send NPage key
# data to prevent extraneous chars in output
bind -T root NPage \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= '#{alternate_on}' \
			'send-keys NPage' \
			''"

# same for ctrl-f, but half-page scroll
bind -T root C-f \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= '#{alternate_on}' \
			'send-keys C-f' \
			''"

# instead of NPage, guess that 20 lines is about half a page
bind -T root C-NPage \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= '#{alternate_on}' \
			'send-keys -N 20 Down' \
			''"

bind -T root M-NPage \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= '#{alternate_on}' \
			'send-keys -N 4 NPage' \
			''"

# first press does not scroll but just enter copy-mode
bind -T root C-Up \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= '#{alternate_on}' \
			'send-keys C-Up' \
			'copy-mode ; send -XN 2 cursor-left'"

# first press does not scroll but just enter copy-mode
bind -T root C-k \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= '#{alternate_on}' \
			'send-keys C-k' \
			'copy-mode ; send -XN 2 cursor-left'"

# ==============================================

# mouse scroll / cut/paste options ...

set -g mouse on

#set-option -g terminal-overrides 'xterm*:smcup@:rmcup@'
#set-option -ga terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q'
#set-option -ga terminal-overrides ',*256col*:RGB:sitm=\E[3m'

# Dont cancel highlight when releasing button
# (only works with tmux 2.4+)
#unbind -T copy-mode-vi MouseDragEnd1Pane
# could also copy to clipboards
bind   -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-no-clear "xsel -i -p --rmlastnl"

# ----------

# no longer use tmux-better-mouse-mode plugin
# https://github.com/nhdaly/tmux-better-mouse-mode
#set -g @scroll-down-exit-copy-mode "on"
#set -g @emulate-scroll-for-no-mouse-alternate-buffer "on"
#run-shell ~/.byobu/tmux-better-mouse-mode/scroll_copy_mode.tmux

# ----------

# or method below which tries to return back to original mode
#bind -T copy-mode-vi MouseDrag1Pane setw @mode 1\; copy-mode-vi -M
#bind -T copy-mode-vi MouseDragEnd1Pane if -F '#{@mode}' 'send -X copy-selection' 'send -X copy-selection-and-cancel'
#bind -n MouseDrag1Pane if -F '#{mouse_any_flag}' 'if -F "#{pane_in_mode}" "setw -u @mode; copy-mode-vi -M" "send-keys -M"' "setw -u @mode; copy-mode-vi -M"

# ----------

# older method to toggle mouse mode
#unbind m
#bind m run "\
#    tmux show-options -g | grep 'mouse ' | grep -q on; \
#    if [ \$? = 0 ]; \
#    then  \
#        toggle=off;  \
#    else  \
#        toggle=on;  \
#    fi;  \
#    tmux display-message \"mouse is now: \$toggle\";  \
#    tmux set-option -g mouse \$toggle; \
#    "

# ==============================================

# from: https://github.com/sc0ty/config
########################
##### MOUSE CONFIG #####
########################
#
#set -gq mouse on
#
#bind-key -n WheelUpPane \
#	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
#	if-shell -Ft= "#{pane_in_mode}" \
#		"send-keys -M ; send-keys -M ; send-keys -M" \
#		"if-shell -Ft= \"#{mouse_any_flag}\" \
#			\"send-keys -M\" \
#			\"if-shell -Ft= '#{alternate_on}' \
#				'send-keys Up Up Up' \
#				'copy-mode'\""
#
#bind-key -n WheelDownPane \
#	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
#	if-shell -Ft= "#{pane_in_mode}" \
#		"send-keys -M ; send-keys -M ; send-keys -M" \
#		"if-shell -Ft= \"#{mouse_any_flag}\" \
#			\"send-keys -M\" \
#			\"if-shell -Ft= '#{alternate_on}' \
#				'send-keys Down Down Down'\""
#
#bind-key -n MouseDrag1Pane \
#	if-shell -Ft= "#{mouse_any_flag}" \
#		"if-shell -Ft= '#{pane_in_mode}' 'copy-mode -M' 'send-keys -M'" \
#		"copy-mode -M"
#
## paste with middle click
#bind-key -n MouseDown2Pane run "xsel -o | tmux load-buffer - ; tmux paste-buffer"
#
## double click to select word in normal mode if mouse is not handled
#bind-key -n DoubleClick1Pane \
#	if-shell -Ft= "#{mouse_any_flag}" \
#		"send-keys -M" \
#		"select-pane \; copy-mode \; send-keys -X select-word"
#
## triple click to select line in normal mode if mouse is not handled
#bind-key -n TripleClick1Pane \
#	if-shell -Ft= "#{mouse_any_flag}" \
#		"send-keys -M" \
#		"select-pane \; copy-mode \; send-keys -X select-line"
#
## drag & drop windows on status line by mouse
#bind-key -n MouseDrag1Status swap-window -t=
#
## new window by right click on status line
#bind-key -n MouseDown3Status new-window -a -t= -c '#{pane_current_path}'
#
## new window in background by middle click on status line
#bind-key -n MouseDown2Status new-window -ad -t= -c '#{pane_current_path}'
#
## don't scroll to bottom after mouse select
## workaround for selection being unselected on DragEnd
##bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection
#bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-no-clear "xsel -ip"
#
## deselect with mouse click
#bind-key -T copy-mode-vi MouseDown1Pane select-pane \; send-keys -X clear-selection
#
# exit from copy-mode with right-click
#unbind-key -n MouseDown3Pane
#bind-key -T copy-mode-vi MouseDown3Pane select-pane \; send-keys -X cancel
#
# ==============================================

# instead of clear-selection, use stop-selection
# helps from having extra clicks wipe out selection ...
bind -T copy-mode-vi MouseDown1Pane \
    select-pane \; send -X stop-selection

bind -T copy-mode-vi MouseDrag1Pane \
    select-pane \; send -X clear-selection \; send -X begin-selection

bind -T root         MouseDrag1Pane \
    if-shell -Ft= "#{mouse_any_flag}" \
        "send-keys -M" \
        "copy-mode -M"

# default select-word does not always stop selelction with a scroll
bind -T copy-mode-vi DoubleClick1Pane \
    select-pane \; send -X clear-selection \; send -l lbve \; send -X stop-selection \; send -X copy-pipe-no-clear "xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}"

# enter copy-mode and copy
bind -T root         DoubleClick1Pane \
 	if-shell -Ft= "#{mouse_any_flag}" \
 		"send-keys -M" \
        "select-pane ; copy-mode ; send -X clear-selection ; send -l lbve ; send -X stop-selection ; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\""

# default select-line does not always stop selelction with a scroll
# instead of select-line we can try to get next larger entity (lBvE instead of 0v$)
bind -T copy-mode-vi TripleClick1Pane \
    select-pane \; send -X clear-selection \; send -l lBvE \; send -X stop-selection \; send -X copy-pipe-no-clear "xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc"
#   select-pane \; run "tmux send -X clear-selection ; tmux send -l 0v\\\$ ; tmux send -X copy-pipe-no-clear \"xclip -sel c >/dev/null ; xclip -o -sel c | xclip -sel p >/dev/null\" ; tmux display-message 'copied to primary and clipboard'"

# enter copy-mode and copy
# instead of select-line we can try to get next larger entity (lBvE instead of 0v$)
bind -T root         TripleClick1Pane \
 	if-shell -Ft= "#{mouse_any_flag}" \
 		"send-keys -M" \
        "select-pane ; copy-mode ; send -X clear-selection ; send -l lBvE ; send -X stop-selection ; send -X copy-pipe-no-clear \"xsel -i -p --rmlastnl --sc /dev/shm/tmux#{session_name}.spc\""
#       "select-pane ; copy-mode ; send -X clear-selection ; send -l 0v$ ; send -X copy-pipe-no-clear \"xclip -sel c >/dev/null ; xclip -o -sel c | xclip -sel p >/dev/null\" ; display-message 'copied to primary and clipboard'"

bind -T copy-mode-vi WheelUpPane \
    select-pane \; send-keys -XN 3 scroll-up
#   select-pane \; send -X stop-selection \; send-keys -XN 3 scroll-up

# Alt-Wheel for a faster scroll
bind -T copy-mode-vi M-WheelUpPane \
    select-pane \; send-keys -XN 60 scroll-up
#   select-pane \; send -X stop-selection \; send-keys -XN 60 scroll-up

bind -T root         WheelUpPane \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= \"#{mouse_any_flag}\" \
			\"send-keys -M\" \
			\"if-shell -Ft= '#{alternate_on}' \
				'send-keys -N 3 Up' \
				'copy-mode ; send -XN 2 cursor-left ; send -XN 3 scroll-up'\""

bind -T root         M-WheelUpPane \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= \"#{mouse_any_flag}\" \
			\"send-keys -M\" \
			\"if-shell -Ft= '#{alternate_on}' \
				'send-keys -N 20 Up' \
				'copy-mode ; send -XN 2 cursor-left ; send -XN 30 scroll-up'\""

# with mouse scroll - want to exit copy-mode when at bottom ...
bind -T copy-mode-vi WheelDownPane \
	select-pane \; send -XN 3 scroll-down-and-cancel
#	select-pane \; send -X stop-selection \; send -XN 3 scroll-down-and-cancel
#	select-pane \; if -F "#{selection_present}" "send -X stop-selection ; send -XN 3 scroll-down-and-cancel" "send -XN 3 scroll-down-and-cancel"

# Alt-Wheel for a faster scroll
bind -T copy-mode-vi M-WheelDownPane \
	select-pane \; send -XN 60 scroll-down-and-cancel
#	select-pane \; send -X stop-selection \; send -XN 60 scroll-down-and-cancel
#	select-pane \; if -F "#{selection_present}" "send -X stop-selection ; send -XN 60 scroll-down-and-cancel" "send -XN 60 scroll-down-and-cancel"

# if not #{alternate_on} dont send Down key
# data to prevent extraneous chars in output
bind -T root         WheelDownPane \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= \"#{mouse_any_flag}\" \
			\"send-keys -M\" \
			\"if-shell -Ft= '#{alternate_on}' \
				'send-keys -N 3 Down' \
				''\""

bind -T root         M-WheelDownPane \
	if-shell -Ft= "#{?pane_active,0,1}" "select-pane -t=" \
		"if-shell -Ft= \"#{mouse_any_flag}\" \
			\"send-keys -M\" \
			\"if-shell -Ft= '#{alternate_on}' \
				'send-keys -N 20 Down' \
				''\""

# ==============================================

